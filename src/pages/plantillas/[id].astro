---
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import plantillasData from "../../data/plantillas.json";
import { ClientRouter } from "astro:transitions";
export const prerender = true;

export function getStaticPaths() {
  return plantillasData.map((plantilla) => {
    return {
      params: { id: plantilla.id.toString().trim() },
      props: { p: plantilla },
    };
  });
}

const { p } = Astro.props;
const { id } = Astro.params;

if (!p) {
  console.log("Buscando ID:", id);
  console.log("Plantilla encontrada:", p ? "SÍ" : "NO");
  return Astro.redirect("/404");
}
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{p?.titulo} - Descargar Gratis | Plantillas Pro</title>
    <meta
      name="description"
      content={`Descarga gratis: ${p?.titulo}. ${p.descripcion}. Formato editable ${p.formato}.`}
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <ClientRouter />
    <style>
      body {
        font-family: "Inter", sans-serif;
        color: #334155;
      }
      .breadcrumb-item a {
        color: #64748b;
      }
      .download-card {
        position: sticky;
        top: 2rem;
      }
      .ad-box {
        background-color: #f1f5f9;
        border: 2px dashed #cbd5e1 !important;
        color: #64748b;
      }
      .img-preview-container {
        background: #fff;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
      }
      .img-preview-container img {
        width: 100%;
        height: auto;
        display: block;
      }

      [transition\:name^="img-"] {
        aspect-ratio: 16 / 9;
        width: 100%;
        height: auto;
        object-fit: cover;
        will-change: transform, opacity; /* Esto prepara a la tarjeta gráfica */
      }
    </style>
  </head>
  <body class="bg-light d-flex flex-column min-vh-100">
    <Header />

    <div class="bg-white border-bottom py-5 shadow-sm">
      <div class="container text-center text-md-start">
        <nav aria-label="breadcrumb">
          <ol
            class="breadcrumb mb-3 justify-content-center justify-content-md-start"
          >
            <li class="breadcrumb-item">
              <a href="/" class="text-decoration-none">Inicio</a>
            </li>
            <li class="breadcrumb-item text-capitalize">
              <a href={`/${p.categoria}`} class="text-decoration-none"
                >{p.categoria}</a>
            </li>
            <li class="breadcrumb-item active fw-bold" aria-current="page">
              {p.titulo}
            </li>
          </ol>
        </nav>
        <h1 class="display-4 fw-bold text-dark mb-3">
          <span class="me-2">{p.icono}</span>{p.titulo}
        </h1>
        <p class="lead text-secondary mb-0">{p.descripcion}</p>
      </div>
    </div>

    <div class="container py-5 flex-grow-1">
      <div class="row g-5">
        <div class="col-lg-8">
          <div class="img-preview-container mb-5">
            <img
              transition:name={`img-${p.id}`}
              src={p.imagen || "/img/placeholder-preview.jpg"}
              alt={`Vista previa de ${p.titulo}`}
              loading="lazy"
            />
          </div>

          <div class="card border-0 shadow-sm rounded-4 mb-5">
            <div class="card-body p-4 p-md-5">
              <h2 class="h3 fw-bold mb-4 text-dark">
                Información de la plantilla
              </h2>
              <p class="text-secondary fs-5 lh-lg mb-4">{p.contenido}</p>

              <div class="bg-light rounded-4 p-4 mt-4">
                <h3 class="h5 fw-bold mb-3 text-dark">
                  ¿Qué obtendrás al descargar?
                </h3>
                <ul class="list-unstyled mb-0 text-secondary">
                  <li class="mb-3 d-flex align-items-center">
                    <span class="text-success me-2">✔</span> Archivo totalmente editable
                    en formato <strong>{p.formato}</strong>
                  </li>
                  <li class="mb-3 d-flex align-items-center">
                    <span class="text-success me-2">✔</span> Configurado para impresión
                    directa en A4
                  </li>
                  <li class="mb-0 d-flex align-items-center">
                    <span class="text-success me-2">✔</span> Descarga inmediata sin
                    registros ni publicidad intrusiva
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="ad-box rounded-4 p-4 text-center">
            <p class="small text-uppercase fw-bold mb-2">
              Publicidad recomendada
            </p>
            <div class="py-2">[ ADSENSE DISPLAY HORIZONTAL ]</div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card border-0 shadow-sm rounded-4 mb-4 download-card">
            <div class="card-body p-4 text-center">
              <span
                class={`badge border rounded-pill mb-3 px-3 py-2 fs-6 ${p.etiqueta}`}
              >
                {p.formato}
              </span>
              <h4 class="fw-bold mb-3 text-dark">Descargar Gratis</h4>

              <a
                href="#"
                class="btn btn-primary btn-lg w-100 fw-bold shadow-sm mb-3 py-3"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  fill="currentColor"
                  class="bi bi-download me-2 mb-1"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"
                  ></path>
                  <path
                    d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"
                  ></path>
                </svg>
                Descargar ahora
              </a>
              <p class="text-muted mb-4" style="font-size: 0.75rem;">
                Verificado libre de virus.
              </p>

              <div
                class="ad-box rounded-3 p-4 text-center"
                style="min-height: 250px; display: flex; flex-direction: column; align-items: center; justify-content: center;"
              >
                <p class="small text-uppercase fw-bold mb-2">Publicidad</p>
                <p class="text-muted small mb-0">
                  [ ADSENSE VERTICAL / CUADRADO ]
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <Footer />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    ></script>
  </body>
</html>
